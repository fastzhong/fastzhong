<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.uob.gwb.pbp.dao.pws.PwsSaveDao">

    <select id="getBankRefSequenceNum"
            resultType="java.lang.Integer" statementType="PREPARED"
            flushCache="true" databaseId="oracle">
        <![CDATA[select seq_bank_reference.nextval from dual]]>
    </select>

    <select id="getBatchBankRefSequenceNum"
            resultType="java.lang.Integer" statementType="PREPARED" parameterType="java.lang.Integer"
            flushCache="true" databaseId="oracle">
        <![CDATA[select seq_bank_reference.nextval from dual connect by level <= <@p name='count'/> ]]>
    </select>

    <!-- Insert PwsTransactions -->
    <insert id="insertPwsTransactions" parameterType="com.uob.gwb.pbp.po.PwsTransactions"
            statementType="PREPARED" useGeneratedKeys="true" keyProperty="transactionId" keyColumn="transaction_id">
        <![CDATA[
        INSERT INTO pws_transactions (
            bank_entity_id,
            resource_id,
            feature_id,
            correlation_id,
            bank_reference_id,
            application_type,
            account_currency,
            account_number,
            company_group_id,
            company_id,
            company_name,
            transaction_currency,
            total_amount,
            total_child,
            highest_amount,
            authorization_status,
            capture_status,
            customer_transaction_status,
            processing_status,
            reject_reason,
            initiated_by,
            initiation_time,
            released_by,
            release_date,
            change_token
        ) VALUES (
            #{bankEntityId},
            #{resourceId},
            #{featureId},
            #{correlationId},
            #{bankReferenceId},
            #{applicationType},
            #{accountCurrency},
            #{accountNumber},
            #{companyGroupId},
            #{companyId},
            #{companyName},
            #{transactionCurrency},
            #{totalAmount},
            #{totalChild},
            #{highestAmount},
            #{authorizationStatus},
            #{captureStatus},
            #{customerTransactionStatus},
            #{processingStatus},
            #{rejectReason},
            #{initiatedBy},
            #{initiationTime},
            #{releasedBy},
            #{releaseDate},
            #{changeToken}
        )
        ]]>
    </insert>

    <!-- Insert PwsBulkTransactions -->
    <insert id="insertPwsBulkTransactions" parameterType="com.uob.gwb.pbp.po.PwsBulkTransactions"
            statementType="PREPARED" useGeneratedKeys="true" keyProperty="bkTransactionId" keyColumn="bk_transaction_id">
        <![CDATA[
        INSERT INTO pws_bulk_transactions (
            transaction_id,
            file_upload_id,
            recipients_reference,
            recipients_description,
            fate_file_name,
            fate_file_path,
            combine_debit,
            status,
            change_token,
            error_detail,
            final_fate_updated_date,
            ack_file_path,
            ack_updated_date,
            transfer_date,
            user_comments,
            dmp_batch_number,
            reject_code,
            batch_booking,
            charge_options,
            payroll_options
        ) VALUES (
            #{transactionId},
            #{fileUploadId},
            #{recipientsReference},
            #{recipientsDescription},
            #{fateFileName},
            #{fateFilePath},
            #{combineDebit},
            #{status},
            #{changeToken},
            #{errorDetail},
            #{finalFateUpdatedDate},
            #{ackFilePath},
            #{ackUpdatedDate},
            #{transferDate},
            #{userComments},
            #{dmpBatchNumber},
            #{rejectCode},
            #{batchBooking},
            #{chargeOptions},
            #{payrollOptions}
        )
        ]]>
    </insert>

    <!-- Insert PwsBulkTransactionInstructions -->
    <insert id="insertPwsBulkTransactionInstructions" parameterType="com.uob.gwb.pbp.po.PwsBulkTransactionInstructions"
            statementType="PREPARED" useGeneratedKeys="true" keyProperty="childTransactionInstructionsId"
            keyColumn="child_transaction_instructions_id">
        <![CDATA[
        INSERT INTO pws_bulk_transaction_instructions (
            child_bank_reference_id,
            transaction_id,
            bank_reference_id,
            transaction_currency,
            transaction_amount,
            equivalent_currency,
            equivalent_amount,
            destination_country,
            destination_bank_name,
            fx_flag,
            charge_options,
            original_value_date,
            value_date,
            settlement_date,
            payment_code_id,
            payment_details,
            rail_code,
            is_recurring,
            is_pre_approved,
            customer_reference,
            customer_transaction_status,
            processing_status,
            reject_reason,
            remarks_for_approval,
            user_comments,
            duplication_flag,
            reject_code,
            transfer_speed,
            dmp_trans_ref,
            child_template_id,
            initiation_time
        ) VALUES (
            #{childBankReferenceId},
            #{transactionId},
            #{bankReferenceId},
            #{transactionCurrency},
            #{transactionAmount},
            #{equivalentCurrency},
            #{equivalentAmount},
            #{destinationCountry},
            #{destinationBankName},
            #{fxFlag},
            #{chargeOptions},
            #{originalValueDate},
            #{valueDate},
            #{settlementDate},
            #{paymentCodeId},
            #{paymentDetails},
            #{railCode},
            #{isRecurring},
            #{isPreApproved},
            #{customerReference},
            #{customerTransactionStatus},
            #{processingStatus},
            #{rejectReason},
            #{remarksForApproval},
            #{userComments},
            #{duplicationFlag},
            #{rejectCode},
            #{transferSpeed},
            #{dmpTransRef},
            #{childTemplateId},
            #{initiationTime}
        )
        ]]>
    </insert>

    <!-- Insert PwsParties -->
    <insert id="insertPwsParties" parameterType="com.uob.gwb.pbp.po.PwsParties"
            statementType="PREPARED" useGeneratedKeys="true" keyProperty="partyId" keyColumn="party_id">
        <![CDATA[
        INSERT INTO pws_parties (
            bank_entity_id,
            transaction_id,
            bank_reference_id,
            child_bank_reference_id,
            bank_code,
            bank_id,
            party_account_type,
            party_account_number,
            party_account_name,
            party_nick_name,
            party_masked_nick_name,
            party_account_currency,
            party_agent_bic,
            party_name,
            party_role,
            residential_status,
            proxy_id,
            proxy_id_type,
            id_issuing_country,
            product_type,
            primary_identification_type,
            primary_identification_value,
            secondary_identification_type,
            secondary_identification_value,
            registration_id,
            beneficiary_reference_id,
            swift_code,
            party_type,
            residency_status,
            account_ownership,
            relationship_type,
            ultimate_payee_country_code,
            ultimate_payee_name,
            ultimate_payer_name,
            is_preapproved,
            party_modified_date,
            beneficiary_change_token
        ) VALUES (
            #{bankEntityId},
            #{transactionId},
            #{bankReferenceId},
            #{childBankReferenceId},
            #{bankCode},
            #{bankId},
            #{partyAccountType},
            #{partyAccountNumber},
            #{partyAccountName},
            #{partyNickName},
            #{partyMaskedNickName},
            #{partyAccountCurrency},
            #{partyAgentBIC},
            #{partyName},
            #{partyRole},
            #{residentialStatus},
            #{proxyId},
            #{proxyIdType},
            #{idIssuingCountry},
            #{productType},
            #{primaryIdentificationType},
            #{primaryIdentificationValue},
            #{secondaryIdentificationType},
            #{secondaryIdentificationValue},
            #{registrationId},
            #{beneficiaryReferenceId},
            #{swiftCode},
            #{partyType},
            #{residencyStatus},
            #{accountOwnership},
            #{relationshipType},
            #{ultimatePayeeCountryCode},
            #{ultimatePayeeName},
            #{ultimatePayerName},
            #{isPreapproved},
            #{partyModifiedDate},
            #{beneficiaryChangeToken}
        )
        ]]>
    </insert>

    <!-- Insert PwsPartyContacts -->
    <insert id="insertPwsPartyContacts" parameterType="com.uob.gwb.pbp.po.PwsPartyContacts" 
        statementType="PREPARED">
        <![CDATA[
        INSERT INTO pws_party_contacts (
            party_id,
            transaction_id,
            bank_entity_id,
            bank_reference_id,
            child_bank_reference_id,
            address1,
            address2,
            address3,
            address4,
            address5,
            phone_country,
            phone_no,
            phone_country_code,
            address_category,
            country,
            province,
            district_name,
            sub_district_name,
            street_name,
            town_name,
            postal_code,
            building_number,
            building_name,
            floor,
            unit_number,
            department,
            sub_department,
            party_contact_type
        ) VALUES (
            #{partyId},
            #{transactionId},
            #{bankEntityId},
            #{bankReferenceId},
            #{childBankReferenceId},
            #{address1},
            #{address2},
            #{address3},
            #{address4},
            #{address5},
            #{phoneCountry},
            #{phoneNo},
            #{phoneCountryCode},
            #{addressCategory},
            #{country},
            #{province},
            #{districtName},
            #{subDistrictName},
            #{streetName},
            #{townName},
            #{postalCode},
            #{buildingNumber},
            #{buildingName},
            #{floor},
            #{unitNumber},
            #{department},
            #{subDepartment},
            #{partyContactType}
        )
        ]]>
    </insert>

    <!-- Insert PwsTransactionAdvices -->
    <insert id="insertPwsTransactionAdvices" parameterType="com.uob.gwb.pbp.po.PwsTransactionAdvices"
            statementType="PREPARED">
        <![CDATA[
        INSERT INTO pws_transaction_advices (
            party_id,
            bank_entity_id,
            transaction_id,
            bank_reference_id,
            child_bank_reference_id,
            advice_id,
            party_name1,
            party_name2,
            party_fax_number,
            party_contact_number,
            reference_no,
            advise_message,
            delivery_method,
            delivery_address
        ) VALUES (
            #{partyId},
            #{bankEntityId},
            #{transactionId},
            #{bankReferenceId},
            #{childBankReferenceId},
            #{adviceId},
            #{partyName1},
            #{partyName2},
            #{partyFaxNumber},
            #{partyContactNumber},
            #{referenceNo},
            #{adviseMessage},
            #{deliveryMethod},
            #{deliveryAddress}
        )
        ]]>
    </insert>

    <!-- Insert PwsTaxInstructions -->
    <insert id="insertPwsTaxInstructions" parameterType="com.uob.gwb.pbp.po.PwsTaxInstructions"
            statementType="PREPARED">
        <![CDATA[
        INSERT INTO pws_tax_instructions (
            transaction_id,
            bank_reference_id,
            child_bank_reference_id,
            tax_payer_name,
            tax_payer_id,
            tax_payee_name,
            tax_payee_id,
            tax_name,
            tax_type,
            tax_payment_condition,
            tax_document_number,
            tax_sequence_number,
            taxable_amount,
            tax_amount,
            vat_amount,
            type_of_income,
            tax_rate_in_percentage,
            tax_description,
            tax_period_year,
            tax_period_month,
            tax_period_day,
            tax_subscription,
            tax_return_type,
            payer_vat_branch_code,
            payee_vat_branch_code,
            vat_branch_code
        ) VALUES (
            #{transactionId},
            #{bankReferenceId},
            #{childBankReferenceId},
            #{taxPayerName},
            #{taxPayerId},
            #{taxPayeeName},
            #{taxPayeeId},
            #{taxName},
            #{taxType},
            #{taxPaymentCondition},
            #{taxDocumentNumber},
            #{taxSequenceNumber},
            #{taxableAmount},
            #{taxAmount},
            #{vatAmount},
            #{typeOfIncome},
            #{taxRateInPercentage},
            #{taxDescription},
            #{taxPeriodYear},
            #{taxPeriodMonth},
            #{taxPeriodDay},
            #{taxSubscription},
            #{taxReturnType},
            #{payerVatBranchCode},
            #{payeeVatBranchCode},
            #{vatBranchCode}
        )
        ]]>
    </insert>

    <!-- Insert PwsRejectedRecord -->
    <insert id="insertPwsRejectedRecord" parameterType="com.uob.gwb.pbp.po.PwsRejectedRecord" statementType="PREPARED"
            useGeneratedKeys="true" keyProperty="rejectedRecordId" keyColumn="rejected_record_id">
        <![CDATA[
        INSERT INTO pws_rejected_record (
            entity_type,
            entity_id,
            sequence_no,
            line_no,
            colum_no,
            created_by,
            created_date,
            bank_reference_id,
            transaction_id,
            reject_code,
            error_detail
        ) VALUES (
            #{entityType},
            #{entityId},
            #{sequenceNo},
            #{lineNo},
            #{columNo},
            #{createdBy},
            #{createdDate},
            #{bankReferenceId},
            #{transactionId},
            #{rejectCode},
            #{errorDetail}
        )
        ]]>
    </insert>


    <!-- Insert PwsTransitMessage -->
    <insert id="insertPwsTransitMessage" statementType="PREPARED"
            parameterType="com.uob.gwb.pbp.po.PwsTransitMessage"
            keyProperty="messageId" useGeneratedKeys="true" keyColumn="message_id">
        <![CDATA[
        INSERT INTO pws_transit_message (
            message_ref_no,
            bank_reference_id,
            correlation_id,
            message_content,
            service_type,
            end_system,
            processing_date,
            retry_count,
            status
        ) VALUES (
            #{messageRefNo},
            #{bankReferenceId},
            #{correlationId},
            #{messageContent,jdbcType=BLOB},
            #{serviceType},
            #{endSystem},
            #{processingDate},
            #{retryCount},
            #{status}
        )
        ]]>
    </insert>

</mapper>